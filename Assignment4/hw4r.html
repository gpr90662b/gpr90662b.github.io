<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
  <title>Assignment 4</title>
  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="jquery-ui.css">
  <link rel="stylesheet" href="hw4r.css">
  <script src="jquery-min.js"></script>
  <script src="jquery-ui.min.js"></script>
  <script  src="webgl-utils.js"></script>
  <script src="gl-matrix-min.js"></script>
  <script src="geometryObjectsr.js"></script> 
  <script src="hw4r.js"></script>
  <script src="draw_global.js"></script>
  <script src="move_lights.js"></script>
  <script src="move_camera.js"></script>
  <style>
    .ui-spinner {
    font-size: 80%;
    width: 55px;
    }
</style>
  
  <script id="shader-vs" type="x-shader/x-vertex">
  //
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec4 aVertexColor;
    uniform mat4 mvMatrix;
    uniform mat4 pMatrix;
   
    
    varying vec3 myVertex ;  
    varying vec3 myNormal ; // transformed normal
    varying vec4 vColor; //vertex color, I used for solid mode

    void main(void) {
        vec4 coords = vec4(aVertexPosition,1.0);
        vec4 eyeCoords = mvMatrix * coords;
        gl_Position = pMatrix * eyeCoords;
        
        vColor = aVertexColor;
        myNormal =  aVertexNormal ;
        myVertex =  eyeCoords.xyz;
     
    }
  </script>
  
  <script id="shader-fs" type="x-shader/x-fragment">
     #ifdef GL_FRAGMENT_PRECISION_HIGH
       precision highp float;
    #else
       precision mediump float;
    #endif
 
    uniform bool uRenderMode; //wire, solid
    uniform vec4 uColor; //wire frame color 
    
    //Material property
    uniform vec4 ambient; 
    uniform vec4 diffuse; 
    uniform vec4 specular;    
    uniform float shininess; 
    //uniform vec4 emission; 
    
    const int numLights = 10; 
    uniform bool lightFlag; // lighting
    uniform float attFactor;  //point light attenuation factor
    uniform ivec4 lightIndFlag;
    uniform vec4 lightPosition[numLights]; // positions of lights 
    uniform vec4 alightColor[numLights]; // colors of lights
    uniform vec4 dlightColor[numLights]; // colors of lights
    uniform vec4 slightColor[numLights]; // colors of lights
    uniform int numUsed;     // number of lights used
    
    
     uniform mat3 normalMatrix;
   
    varying vec3 myNormal;  // normal
    varying vec3 myVertex;  
    
    varying vec4 vColor; //color for the solid mode
 //  
    void main(void) {
        if ( lightFlag == false ) {
            if ( uRenderMode == true ) {   
                gl_FragColor = diffuse; //vColor     
            }
            else {
                gl_FragColor = uColor;
            }
        } else {
             vec4 globalAmbient= vec4(0.1, 0.1, 0.1, 1);
             vec3 V = normalize(-myVertex) ; // view vector for lighting computation, eye at 0,0,0
            //init variable
            vec3 N = normalize(normalMatrix * myNormal);
            vec4  sum = vec4(0);
            vec3 L = vec3(0);
            vec3 H = vec3(0); //phong and Blinn model
            float d, attdiv;
            float attn;
            for ( int i = 0; i < 10; i++) {
                if ( lightIndFlag[i] == 1 ) { //if this light is on
                    if ( lightPosition[i].w == 0.0 ) {  // directional light 
           
                         L = normalize(lightPosition[i].xyz);
                         attn = 1.0;
                       
                    } else {
                        vec3 lightPos = lightPosition[i].xyz / lightPosition[i].w ;
                        
                        L = normalize (lightPos - myVertex) ; // no attenuation
                        d = length(lightPos-myVertex);
                        attdiv =  ( attFactor * d*d);
                        if ( attdiv < 1.0 )
                            attdiv = 1.0;
                        attn = 1.0/attdiv;
                        
                    }
                    //ambient 
                    vec4 ambientComponent = ambient * alightColor[i];
                     //diffuse               
                    float nDotL = dot(N,L)  ;
                    vec4 lambert = diffuse * dlightColor[i] * max (nDotL, 0.0) ;  
                    //specular
                    H = normalize( L + V ) ;
                    float nDotH = dot(N,H) ;
                    vec4 phong =  specular * slightColor[i] * pow (max(nDotH, 0.0), shininess) ;
                    //add diffuse + specular
                    sum  = sum + ambientComponent +  attn*(lambert + phong) ;
                }
                if ( i == numUsed-1 ) {
                   break;
                }
             } 
             sum = sum + globalAmbient;
             gl_FragColor = clamp(sum, vec4(0), vec4(1));
         
        }
    }
  </script>
  
</head>

<body>
  <div id="container">
  <div id="leftSide"> 
  
  <p>
  <button id="setupScene" class="lightbtn" onclick="setupScene();">Preset Scene</button>
  <br />
  <button id="move_lights" class="lightbtn" onclick="move_lights_demo();">Move Lights</button>
  
  <td><button id="stop_lights"  class="btn" onclick="stop_lights();">Stop Lights</button>
  <br />
  <button id="move_camera" class="lightbtn"  onclick="move_camera_demo();">Move Camera</button>
  <button id="stop_camera"  class="btn"  onclick="stop_camera();">Stop Camera</button>
  <br />
  <button id="resetScene" class="btn" onclick="resetScene();">Reset Scene</button>
  </p>
  
  
  <br />
  <h3>Light Switches </h3>        
  <input type="checkbox" id="check1" onclick="handleLights(this);"><label for="check1" >PL 1</label>
  <input type="checkbox" id="check2" onclick="handleLights(this);"><label for="check2" >DL 2</label>
  <input type="checkbox" id="check3" onclick="handleLights(this);"><label for="check3" >PL 3</label>
  <input type="checkbox" id="check4" onclick="handleLights(this);"><label for="check4">DL 4</label>
  <br />
  <br />
   <h3> Select Light To Edit: 
   <select id="lightSelect">
    <option value="0">Light 1</option>
    <option value="1">Light 2</option>
    <option value="2">Light 3</option>
    <option value="3">Light 4</option>
   </select>
   <br />
   <br />
    <h3> Light Position </h3> 
        <div id="lightX"><span class="clabel">x</span><span id="lightXVal"></span></div>
        <div id="lightY"><span class="clabel">y</span><span id="lightYVal"></span></div>
        <div id="lightZ"><span class="clabel">z</span><span id="lightZVal"></span></div>
    
   <br />
  
  <h3> Light Attenuation (Light 1 & 3) </h3>
   <div id="lightATT"><span class="clabel"></span><span id="lightATTVal"></span></div>
  
   <br />
   
  <h3>  Light Intensities </h3>
  
 <table>
 <tr>
 <td>Red</td>
 <td>Green</td>
 <td>Blue</td>
 
</tr>
  <tr>
  
  <td><input id="aredSpinner"></td>
  <td><input id="agreenSpinner"></td>
  <td><input id="ablueSpinner"></td> 
<td>Ambient</td>  
  </tr>
  </table>
  

 <table>
  <tr>
  
  <td><input id="dredSpinner"></td>
  <td><input id="dgreenSpinner"></td>
  <td><input id="dblueSpinner"></td>  
  <td>Diffuse</td>
  </tr>
  </table>
  
 <table>
  <tr>
  
  <td><input id="sredSpinner"></td>
  <td><input id="sgreenSpinner"></td>
  <td><input id="sblueSpinner"></td> 
<td>Specular</td>  
 
  </tr>
  </table>
<p>
  <button id="setLightValues">Set Light Intensity</button>
</p> 
</div>
    <div id="webglCanvas">
      <canvas id="gl-canvas" width="800" height="600"> Oops ... your browser doesn't support the HTML5 canvas element </canvas>
      
    </div>
    
    
    <div id="controls">
      
        <h3> Create Object  </h3>
        <div id="shapeSelector">
          <input type="button"  id="cylinder" class="btn" value="Cylinder"   name="shapeGroup" />
          <input type="button" button id="cone"  class="btn"    value="Cone"  name="shapeGroup" />
          <input type="button" id="sphere"  class="btn" value="Sphere" name="shapeGroup"  />
          
           <button id="switch" class="lightbtn">Select/Delete</button><br/>
           <div id="panel" style="display:none"><select id="mySelect"><option>Objects</option></select></div>  
        </div>
       
        <div id="modeSelector">
        <h3 class="secondary"> Render Mode</h3>
          <input type="radio" id="wire"  value="wire" name="renderModeGroup"  />
          <label for="wire">Wire</label>
          <input type="radio" id="solid" value="solid" name="renderModeGroup"  />
          <label for="solid">Solid</label>
          <input type="radio" id="light" value="light" name="renderModeGroup" checked="checked" />
          <label for="light">Lighting </label>         
          <!-- <label for="myColor">Color </label><input type="color" id="myColor"> -->
        </div>
     
      
      <!--- -->
      <div id="transbox">
      
      <h3>Transforms</h3>
      
            <input type="radio" id="model"  value="model" name="transformGroup" checked="checked" />
          <label for="model">Model</label>
          <input type="radio" id="global" value="global" name="transformGroup"  />
          <label for="global">Global</label>      
  
        <h3>Scaling</h3>
        <div id="scaleX"><span class="clabel">x</span><span id="scaleXVal"></span></div>
         <div id="scaleY"><span class="clabel">y</span><span id="scaleYVal"></span></div>
          <div id="scaleZ"><span class="clabel">z</span><span id="scaleZVal"></span></div>
    
      <!--- -->
     
        <h3>Rotation</h3>
        <div id="rotX"><span class="clabel">x</span><span id="rotXVal"></span></div>
        <div id="rotY"><span class="clabel">y</span><span id="rotYVal"></span></div>
        <div id="rotZ"><span class="clabel">z</span><span id="rotZVal"></span></div>
     <!--- -->
      
        <h3>Translation</h3>
        <div id="transX"><span class="clabel">x</span><span id="transXVal"></span></div>
        <div id="transY"><span class="clabel">y</span><span id="transYVal"></span></div>
        <div id="transZ"><span class="clabel">z</span><span id="transZVal"></span></div>
     <!--- -->
    
    </div>
       <div id="viewParam">
        <h3>Camera/View Parameters</h3>
        <table>
 <tr>
 <td>X</td>
 <td>Y</td>
 <td>Z</td>
 
</tr>
  <tr>
  <td><input id="xeyeSpinner"></td>
  <td><input id="yeyeSpinner"></td>
  <td><input id="zeyeSpinner"></td> 
<td>EYE</td>  
  </tr>
  </table>
  

 <table>
  <tr>
  <td><input id="xatSpinner"></td>
  <td><input id="yatSpinner"></td>
  <td><input id="zatSpinner"></td>  
  <td>AT</td>
  </tr>
  </table>
  
 <table>
  <tr>
  
  <td><input id="xupSpinner"></td>
  <td><input id="yupSpinner"></td>
  <td><input id="zupSpinner"></td> 
<td>UP</td>  
 
  </tr>
  </table>
  <br />
  
<p>
  <button id="setViewValues">Update Camera/View</button>
  <button id="defaultView" class="btn" onclick="setDefaultView();">Defaults</button>
</p>
<h3>Projection Type</h3>
         <input type="radio" id="pers"  value="Perspective" name="viewGroup" checked="checked" />
          <label for="pers">Perspective</label>
          <input type="radio" id="ortho" value="Orthogonal" name="viewGroup"  />
          <label for="ortho">Orthogonal</label>
       </div>
</div>
          
    <!-- controls -->
    <header>
      <h1> WebGL Assignment 4: Lighting Phong - Blinn Model</h1>
    </header>
    
  </div>
  <!-- container -->
</body>
</html>