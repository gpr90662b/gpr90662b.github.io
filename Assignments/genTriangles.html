<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Testing Triangles</title>
    <script type="text/javascript" src="../Common/MV.js"></script>
    
    <script>
    
    var points = [];
    points[0] = vec2(4,5);
    points[1] = vec2(10,15);
    points[2] = vec2(25,15);
    points[3] = vec2(50,50);
    points[4] = vec2(67,45);
    points[5] = vec2(67,45);
    points[6] = vec2(67,45);
    
    // 1) define the line between the two points
	Vec2f line = (p2 - p1).normalized();

	// 2) find the normal vector of this line
	Vec2f normal = Vec2f(-line.y, line.x).normalized();

	// 3) find the tangent vector at both the end points:
	//		-if there are no segments before or after this one, use the line itself
	//		-otherwise, add the two normalized lines and average them by normalizing again
	Vec2f tangent1 = (p0 == p1) ? line : ((p1-p0).normalized() + line).normalized();
	Vec2f tangent2 = (p2 == p3) ? line : ((p3-p2).normalized() + line).normalized();

	// 4) find the miter line, which is the normal of the tangent
	Vec2f miter1 = Vec2f(-tangent1.y, tangent1.x);
	Vec2f miter2 = Vec2f(-tangent2.y, tangent2.x);

	// find length of miter by projecting the miter onto the normal,
	// take the length of the projection, invert it and multiply it by the thickness:
	//		length = thickness * ( 1 / |normal|.|miter| )
	float length1 = mThickness / normal.dot(miter1);
	float length2 = mThickness / normal.dot(miter2);
    
    var triangles = [];
    var lineWidth = 6;
    
    function triangleP1P2( p1, p2 ) {
        var line =   normalize( subtract(p2,p1));
        var normal =  normalize(vec2(-line[1], line[0]));
        normal = scale(lineWidth / 2, normal);
        
        c1 = subtract( p1, normal);
        c2 = add(p1,normal);
        c3 = subtract(p2, normal);
        c4 = add(p2, normal);  
        
        triangles.push (c2,c1,c3);
        triangles.push(c3,c4,c2);  
        triCount += 6;
    }
    
    function scaledNormal ( p1, p2 ) {
        var line =   normalize( subtract(p2,p1));
        var normal =  normalize(vec2(-line[1], line[0]));
        normal = scale(lineWidth / 2, normal);
        return normal;
    }
    
    function miterLength(p0, p1, p2, p3) {
     // 1) define the line between the two points
	//Vec2f line = (p2 - p1).normalized();

	// 2) find the normal vector of this line
	//Vec2f normal = Vec2f(-line.y, line.x).normalized();
    
       var line =   normalize( subtract(p2,p1));
        var normal =  normalize(vec2(-line[1], line[0]));
        normal = scale(lineWidth / 2, normal);

	// 3) find the tangent vector at both the end points:
	//		-if there are no segments before or after this one, use the line itself
	//		-otherwise, add the two normalized lines and average them by normalizing again
	//Vec2f tangent1 = (p0 == p1) ? line : ((p1-p0).normalized() + line).normalized();
	//Vec2f tangent2 = (p2 == p3) ? line : ((p3-p2).normalized() + line).normalized();
    
        var tangent1 = equal(p0,p1) ? line :  normalized(add(normalized(suntract(p1,p0)), line));
        var tangent1 = equal(p2,p3) ? line :  normalized(add(normalized(suntract(p3,p2)), line));
    

	// 4) find the miter line, which is the normal of the tangent
	//Vec2f miter1 = Vec2f(-tangent1.y, tangent1.x);
	//Vec2f miter2 = Vec2f(-tangent2.y, tangent2.x);
    
    var miter1 = vec2(-tangent1[1], tangent1[0]);
    var miter2 = vec2(-tangent1[1], tangent1[0]);

	// find length of miter by projecting the miter onto the normal,
	// take the length of the projection, invert it and multiply it by the thickness:
	//		length = thickness * ( 1 / |normal|.|miter| )
	//float length1 = mThickness / normal.dot(miter1);
	//float length2 = mThickness / normal.dot(miter2);
    
    var length1 = 0.5 * lineWidth/ dot(normal, miter1);
    var length1 = 0.5 * lineWidth/ dot(normal, miter2);
    
    
    function genTriangles() {
        
        for ( var i =1; i < vNum - 1; i++ ) {
        
            if  ( i+1 == vNum-1) {
                var normal = scaledNormal(points[i],ponits
                triangleP1P2(points[i], points[i+1]);
            }
            else { // at least three points are available
                var line =   normalize( subtract(p2,p1));
                var normal =  normalize(vec2(-line[1], line[0]));
                normal = scale(lineWidth / 2, normal);
            
            
            
            
        
        
            v = normalize( subtract(points[i],points[i-1]));
           
            normal  = normalize(vec2(-v[1], v[0]));
            normal = scale(lineWidth / 2, normal);
            
            
            
            

            c1 = subtract( points[i-1], normal);
            c2 = add(points[i],perpv);
            c3 = subtract(points[i+1], perpv);
            c4 = add(points[i+1], perpv);  
            
            
            triangles.push (c2,c1,c3);
            triangles.push(c3,c4,c2);
            
            //console.log(triangles.length);
       
        }
    }
    
    function printTriangles() {
    var i;
    
    console.log("printing Triangle Vertices");
    for ( i =0; i < triangles.length; i++ ) {
        console.log(triangles[i][0], triangles[i][1]);
        }
    
    }
 
    window.onload = function() {
        genTriangles();
        printTriangles();
        }    
    </script>
</head>

<body>
   <p> Generating triangles.  </p>
   
    
</body>

</html>